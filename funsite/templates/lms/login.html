## mako

<%inherit file="funsite/parts/base.html" />

## FUN overrides this template to:
## - modify the sidebar

<%!
from django.core.urlresolvers import reverse
from django.utils.translation import ugettext as _

from staticfiles.storage import staticfiles_storage
%>

<%block name="js_extra">
    <script src="${staticfiles_storage.url('arg.js/dist/arg-1.2.js')}"></script>
    <script type="text/javascript">

        var loginForm = $('#login-form');
        loginForm.submit(function() {
            $.ajax({
                type: 'POST',
                url: '/login_ajax',
                data: loginForm.serialize(),
                success: function(data) {
                    var next = Arg.parse(window.location.search)['next'];
                    if (data.redirect_url) {
                        location.href = json.redirect_url;
                    } else if (next) {
                        location.href = next;
                    } else {
                       location.href = "${reverse('dashboard')}";
                    }
                },
                error: function(data) {
                    console.log(data.value)  // error message
                }
            });
            return false;
        })

    </script>
</%block>

<%block name="title">${_("Log into your FUN Account")}</%block>


<section class="introduction">
  <header>
    <h1 class="sr">${_("PLEASE LOG IN to access your account and courses")}</h1>
  </header>
</section>

<section class="login container">
  <section role="main" class="content">
    <form role="form" id="login-form" method="post" data-remote="true" action="/login_ajax" novalidate>
        <input type="hidden" name="csrfmiddlewaretoken" value="${ csrf_token }">
      <!-- status messages -->
      <div role="alert" class="status message">
        <h3 class="message-title">${_("We're Sorry, {platform_name} accounts are unavailable currently").format(platform_name=platform_name)}</h3>
      </div>

      <div role="alert" class="status message submission-error" tabindex="-1">
        <h3 class="message-title">${_("We couldn't log you in.")} </h3>
        <ul class="message-copy">
          <li>${_("Your email or password is incorrect")}</li>
        </ul>
      </div>

      <div role="alert" class="third-party-signin message" tabindex="-1">
        <p class="instructions"> </p>
      </div>

      <p class="instructions sr">
        ${_('Please provide the following information to log into your {platform_name} account. Required fields are noted by <strong class="indicator">bold text and an asterisk (*)</strong>.').format(platform_name=platform_name)}
      </p>

      <div class="group group-form group-form-requiredinformation">
        <h2 class="sr">${_('Required Information')}</h2>

        <ol class="list-input">
          <li class="field required text" id="field-email">
            <label for="email">${_('E-mail')}</label>
            <input class="" id="email" type="email" name="email" value="" placeholder="${_('example: username@domain.com')}" required aria-required="true" aria-described-by="email-tip" />
            <span class="tip tip-input" id="email-tip">${_("This is the e-mail address you used to register with {platform}").format(platform=platform_name)}</span>
          </li>
          <li class="field required password" id="field-password">
            <label for="password">${_('Password')}</label>
            <input id="password" type="password" name="password" value="" required aria-required="true" />
            <span class="tip tip-input">
              <a href="#forgot-password-modal" rel="leanModal" class="pwd-reset action action-forgotpw" id="forgot-password-link" role="button" aria-haspopup="true">${_('Forgot password?')}</a>
            </span>
          </li>
        </ol>
      </div>

      <div class="group group-form group-form-secondary group-form-accountpreferences">
        <h2 class="sr">${_('Account Preferences')}</h2>

        <ol class="list-input">
          <li class="field required checkbox" id="field-remember">
            <input id="remember-yes" type="checkbox" name="remember" value="true" />
            <label for="remember-yes">${_('Remember me')}</label>
          </li>
        </ol>
      </div>

    % if course_id and enrollment_action:
        <input type="hidden" name="enrollment_action" value="${enrollment_action | h}" />
        <input type="hidden" name="course_id" value="${course_id | h}" />
    % endif

    % if email_opt_in:
        <input type="hidden" name="email_opt_in" value="${email_opt_in | h}" />
    % endif

      <div class="form-actions">
        <button name="submit" type="submit" id="submit" class="action action-primary action-update login-button">Login</button>
      </div>
    </form>


  </section>

  <aside role="complementary">


    <div class="cta cta-help">
      <h3>${_("Not Enrolled?")}</h3>
      <p><a href="${reverse('register_user')}">${_("Sign up for {platform_name} today!").format(platform_name=settings.PLATFORM_NAME)}</a></p>

      ## Disable help unless the FAQ marketing link is enabled
        <h3>${_("Need Help?")}</h3>
        <p>${_("Looking for help in logging in or with your {platform_name} account?").format(platform_name=settings.PLATFORM_NAME)}
        <a href="${marketing_link('HELP')}">
            ${_("View our help section for answers to commonly asked questions.")}
        </a></p>
    </div>
  </aside>
  </section>

